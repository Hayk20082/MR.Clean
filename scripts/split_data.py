import splitfolders
import os
import shutil

# --- 1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã ---
# –ü–∞–ø–∫–∞, –≥–¥–µ –ª–µ–∂–∞—Ç –≤–∞—à–∏ 4 –∫–ª–∞—Å—Å–∞ (glass, plastic, metal, paper)
INPUT_FOLDER = 'data_raw'

# –ü–∞–ø–∫–∞, –∫—É–¥–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã train, valid, test.
# –í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ 'data/'
OUTPUT_FOLDER = 'data'

# –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: train, valid, test
# 80% –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ, 10% –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é, 10% –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
RATIO = (0.8, 0.1, 0.1)

# --- 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ ---

# –ú—ã –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ–º –≤–∞—à—É –ø–∞–ø–∫—É 'data' –≤ 'data_raw' –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã,
# –µ—Å–ª–∏ –≤—ã –ø–æ–ª–æ–∂–∏–ª–∏ —Ç—É–¥–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.
# –ï—Å–ª–∏ —É –≤–∞—Å –ø–∞–ø–∫–∏ 'glass', 'plastic', 'metal', 'paper' –ª–µ–∂–∞—Ç
# –ø—Ä—è–º–æ –≤ 'data', —Ç–æ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –ø–∞–ø–∫—É 'data' –≤—Ä—É—á–Ω—É—é –≤ 'data_raw',
# —á—Ç–æ–±—ã —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª —Å–∞–º —Å–µ–±—è.

if not os.path.exists(INPUT_FOLDER):
    print(f"‚ùå –û–®–ò–ë–ö–ê: –ò—Å—Ö–æ–¥–Ω–∞—è –ø–∞–ø–∫–∞ '{INPUT_FOLDER}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
    print(f"–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–∏ –ø–∞–ø–∫–∏ 'glass', 'plastic', 'metal', 'paper' –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ '{INPUT_FOLDER}/'.")
    exit()

# –ï—Å–ª–∏ –ø–∞–ø–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è 'data' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–¥–∞–ª—è–µ–º –µ—ë,
# —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.
if os.path.exists(OUTPUT_FOLDER):
    print(f"‚ö†Ô∏è –ü–∞–ø–∫–∞ '{OUTPUT_FOLDER}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ...")
    shutil.rmtree(OUTPUT_FOLDER)


# --- 3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è ---
print(f"‚úÖ –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ '{INPUT_FOLDER}'...")
print(f"–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: –û–±—É—á–µ–Ω–∏–µ {RATIO[0]*100}%, –í–∞–ª–∏–¥–∞—Ü–∏—è {RATIO[1]*100}%, –¢–µ—Å—Ç {RATIO[2]*100}%")

try:
    # –ó–∞–ø—É—Å–∫ split-folders
    splitfolders.ratio(
        INPUT_FOLDER,
        output=OUTPUT_FOLDER,
        seed=1337,
        ratio=RATIO,
        group_prefix=None,
        move=False # –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã, –∞ –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å
    )
    print("\nüéâ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print(f"–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–∞–ø–∫–∏: {OUTPUT_FOLDER}/train, {OUTPUT_FOLDER}/valid, {OUTPUT_FOLDER}/test")

except Exception as e:
    print(f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏: {e}")